# 🎲 抽奖结果操作流程详解

## 📊 抽奖概率配置

### 种子类型概率
- 🥕 **胡萝卜种子：50%** (最常见)
- 🍓 **草莓种子：30%** (中等)
- 🥔 **土豆种子：20%** (较少)

### 数量概率
- 📦 **1个种子：70%** (最常见)
- 📦 **2个种子：25%** (中等)
- 📦 **3个种子：5%** (稀有)

## 🎯 所有可能的抽奖结果

| 序号 | 结果 | 概率 | 稀有度 |
|------|------|------|--------|
| 1 | 🥕 胡萝卜种子 x1 | 35% | 最常见 |
| 2 | 🥕 胡萝卜种子 x2 | 12.5% | 常见 |
| 3 | 🥕 胡萝卜种子 x3 | 2.5% | 稀有 |
| 4 | 🍓 草莓种子 x1 | 21% | 常见 |
| 5 | 🍓 草莓种子 x2 | 7.5% | 中等 |
| 6 | 🍓 草莓种子 x3 | 1.5% | 稀有 |
| 7 | 🥔 土豆种子 x1 | 14% | 较少 |
| 8 | 🥔 土豆种子 x2 | 5% | 较少 |
| 9 | 🥔 土豆种子 x3 | 1% | 最稀有 |

## 🔄 抽奖结果操作流程

### 1. 抽奖触发
```java
// 游戏结束时触发
if (alivePlayers <= 1) {
    GameEndLotteryView lotteryView = new GameEndLotteryView(
        parentStage, winnerId, farmService);
    lotteryView.show();
}
```

### 2. 概率计算
```java
// 种子类型选择
double seedRandom = random.nextDouble();
if (seedRandom < 0.5) {
    cropType = CropType.CARROT;        // 50%
} else if (seedRandom < 0.8) {
    cropType = CropType.STRAWBERRY;    // 30%
} else {
    cropType = CropType.POTATO;        // 20%
}

// 数量选择
double quantityRandom = random.nextDouble();
if (quantityRandom < 0.7) {
    quantity = 1;    // 70%
} else if (quantityRandom < 0.95) {
    quantity = 2;    // 25%
} else {
    quantity = 3;    // 5%
}
```

### 3. 结果处理
```java
// 添加到农场库存
farmService.addSeed(playerId, result.cropType, result.quantity);

// 显示结果
String resultText = String.format("🎉 恭喜！获得 %d 个 %s种子！", 
    result.quantity, getCropTypeName(result.cropType));
resultLabel.setText(resultText);
```

### 4. 数据保存
```java
// 自动保存到文件
private void saveFarmData(String playerId) {
    // 保存库存数据
    if (seedInventory.containsKey(playerId)) {
        savedSeedInventory.put(playerId, new HashMap<>(seedInventory.get(playerId)));
    }
    // 保存到 farm_data/inventory_data.txt
    saveAllData();
}
```

## 🎮 实际操作演示

### 示例：抽到胡萝卜种子 x2
1. **显示结果**：`🎉 恭喜！获得 2 个 胡萝卜种子！`
2. **更新库存**：胡萝卜种子数量 +2
3. **保存数据**：写入 `farm_data/inventory_data.txt`
4. **农场显示**：农场界面显示最新库存数量

### 示例：抽到土豆种子 x3 (最稀有)
1. **显示结果**：`🎉 恭喜！获得 3 个 土豆种子！`
2. **更新库存**：土豆种子数量 +3
3. **保存数据**：写入数据文件
4. **农场显示**：农场界面显示最新库存数量

## 🔧 技术实现细节

### 核心方法调用链
```
抽奖按钮点击
    ↓
calculateLotteryResult() - 计算抽奖结果
    ↓
farmService.addSeed() - 添加种子到库存
    ↓
saveFarmData() - 保存数据到文件
    ↓
updateResourceLabels() - 更新界面显示
```

### 数据流向
```
抽奖结果 → 农场服务 → 内存库存 → 文件保存 → 农场界面显示
```

## 🎯 使用场景

1. **游戏结束时**：自动弹出抽奖界面
2. **测试模式**：使用 `LotteryTest` 程序测试
3. **农场查看**：在农场界面查看获得的种子
4. **种植使用**：使用抽到的种子在农场种植

## 📝 注意事项

- 抽奖结果会立即保存，重启游戏后仍然有效
- 农场界面需要手动刷新才能看到最新库存
- 每种种子都有不同的种植和收获特性
- 抽奖概率是固定的，无法修改（除非修改代码）
